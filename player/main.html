<!DOCTYPE html>
<html>
<head>
  <title>Main Active Desktop Page</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#111; color:#eee; }
    .controls { background:#1a1a1a; padding:12px; text-align:center; }
    .controls h1 { margin:0 0 8px; }
    .controls .row { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
    button { background:#222; color:#eee; border:1px solid #444; padding:8px 14px; border-radius:6px; cursor:pointer; }
    button:hover { background:#2b2b2b; }
    .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; padding:10px; height:60vh; }
    iframe { width:100%; height:100%; border:none; border-radius:8px; background:#000; }
    @media(max-width:768px){ .grid{grid-template-columns:repeat(2,1fr);height:auto;} iframe{height:220px;} }
    .activity { background:#1a1a1a; border-top:1px solid #333; padding:10px; font-size:13px; height:20vh; overflow-y:auto; }
    .stats { background:#222; padding:8px; font-size:12px; margin-top:6px; border-radius:6px; }
  </style>
</head>
<body>
  <div class="controls">
    <h1>Main Active Desktop Page</h1>
    <div class="row">
      <button onclick="playAll()">â–¶ Play All</button>
      <button onclick="pauseAll()">â¸ Pause All</button>
      <button onclick="nextAll()">â­ Next All</button>
      <button onclick="shuffleAll()">ğŸ² Shuffle All</button>
      <button onclick="restartAll()">ğŸ” Restart All</button>
      <button onclick="stopAll()">â¹ Stop All</button>
      <button onclick="toggleMuteAll()">ğŸ”‡ Mute/Unmute All</button>
      <button onclick="randomizeVolumeAll()">ğŸ”Š Volume Randomize All</button>
      <button onclick="normalizeVolumeAll()">ğŸš Volume Normalize All</button>
      <button onclick="toggleTheme()">ğŸŒ“ Dark/Light Mode</button>
    </div>
  </div>

  <div class="grid">
    <div id="player1"></div><div id="player2"></div><div id="player3"></div><div id="player4"></div>
    <div id="player5"></div><div id="player6"></div><div id="player7"></div><div id="player8"></div>
  </div>

  <div class="activity" id="activityPanel"></div>
  <div class="stats" id="statsPanel"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let players=[],videoList=[],isMutedAll=true;
    const NORMALIZE_VOLUME_TARGET=20;
    const stats={autoNext:0,manualNext:0,shuffle:0,restart:0,pauses:0,volumeChanges:0};

    function updateStats(){
      document.getElementById("statsPanel").innerHTML=
        `ğŸ“Š Stats â€” AutoNext:${stats.autoNext} | ManualNext:${stats.manualNext} | Shuffle:${stats.shuffle} | Restart:${stats.restart} | Pauses:${stats.pauses} | VolumeChanges:${stats.volumeChanges}`;
    }

    function log(msg){
      console.log(msg);
      const panel=document.getElementById("activityPanel");
      const div=document.createElement("div");
      div.textContent=msg;
      panel.appendChild(div);
      panel.scrollTop=panel.scrollHeight;
      updateStats();
    }
    const ts=()=>new Date().toLocaleTimeString();

    fetch("https://raw.githubusercontent.com/DeadManWalkingTO/MacrosDmW/refs/heads/main/player/list.txt")
      .then(r=>r.text())
      .then(text=>{videoList=text.trim().split("\n").filter(Boolean);initPlayers(getRandomVideos(8));});

    function getRandomVideos(n){return [...videoList].sort(()=>Math.random()-0.5).slice(0,n);}
    function initPlayers(videoIds){
      videoIds.forEach((id,i)=>{players[i]=new YT.Player(`player${i+1}`,{videoId:id,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}});});
    }
    function onPlayerReady(e){e.target.mute();e.target.playVideo();log(`[${ts()}] â–¶ Ready: ${e.target.getVideoData().video_id}`);}
    function onPlayerStateChange(e){
      if(e.data===YT.PlayerState.ENDED){
        const newId=getRandomVideos(1)[0];
        e.target.loadVideoById(newId);
        stats.autoNext++;
        log(`[${ts()}] â­ AutoNext: ${newId}`);
      }
    }

    // Controls
    function playAll(){players.forEach(p=>p.playVideo());log(`[${ts()}] â–¶ Play All`);}
    function pauseAll(){players.forEach(p=>p.pauseVideo());stats.pauses++;log(`[${ts()}] â¸ Pause All`);}
    function stopAll(){players.forEach(p=>p.stopVideo());log(`[${ts()}] â¹ Stop All`);}
    function nextAll(){players.forEach(p=>{let newId=getRandomVideos(1)[0];p.loadVideoById(newId);p.playVideo();});stats.manualNext++;log(`[${ts()}] â­ Next All`);}
    function shuffleAll(){let sh=getRandomVideos(players.length);players.forEach((p,i)=>{p.loadVideoById(sh[i]);p.playVideo();});stats.shuffle++;log(`[${ts()}] ğŸ² Shuffle All`);}
    function restartAll(){let set=getRandomVideos(players.length);players.forEach((p,i)=>{p.stopVideo();p.loadVideoById(set[i]);p.playVideo();});stats.restart++;log(`[${ts()}] ğŸ” Restart All`);}
    function toggleMuteAll(){if(isMutedAll){players.forEach(p=>p.unMute());log(`[${ts()}] ğŸ”Š Unmute All`);}else{players.forEach(p=>p.mute());log(`[${ts()}] ğŸ”‡ Mute All`);}isMutedAll=!isMutedAll;}
    function randomizeVolumeAll(){players.forEach((p,i)=>{let v=Math.floor(Math.random()*101);p.setVolume(v);});stats.volumeChanges++;log(`[${ts()}] ğŸ”Š Randomize Volume All`);}
    function normalizeVolumeAll(){players.forEach((p,i)=>{p.setVolume(NORMALIZE_VOLUME_TARGET);});stats.volumeChanges++;log(`[${ts()}] ğŸš Normalize Volume All`);}
    function toggleTheme(){document.body.classList.toggle("light");log(`[${ts()}] ğŸŒ“ Theme toggled`);}
  </script>
</body>
</html>
