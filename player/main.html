<!DOCTYPE html>
<html>
<head>
  <title>Main Active Desktop Page</title>
  <style>
    :root {
      --bg: #111;
      --fg: #eee;
      --panel-bg: #1a1a1a;
      --btn-bg: #222;
      --btn-fg: #eee;
      --btn-border: #444;
    }
    body.light {
      --bg: #f9f9f9;
      --fg: #222;
      --panel-bg: #eaeaea;
      --btn-bg: #fff;
      --btn-fg: #222;
      --btn-border: #ccc;
    }
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--fg);
    }
    .controls {
      position: sticky;
      top: 0;
      background: var(--panel-bg);
      border-bottom: 1px solid var(--btn-border);
      padding: 12px;
      z-index: 10;
      text-align: center;
    }
    .controls h1 { margin: 0 0 8px; font-size: 20px; }
    .controls .row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    button {
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color: var(--btn-fg);
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: background .15s ease, border-color .15s ease;
    }
    button:hover { background: #2b2b2b; border-color: #666; }
    body.light button:hover { background: #ddd; border-color: #999; }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 10px;
      height: 70vh;
    }
    iframe { width: 100%; height: 100%; border: none; border-radius: 8px; background: #000; }

    @media (max-width: 768px) {
      .grid { grid-template-columns: repeat(2, 1fr); height: auto; }
      iframe { height: 220px; }
    }

    .activity {
      background: var(--panel-bg);
      border-top: 1px solid var(--btn-border);
      padding: 10px;
      font-size: 13px;
      height: 20vh;
      overflow-y: auto;
    }
    .log-entry { margin: 2px 0; }
  </style>
</head>
<body>
  <div class="controls">
    <h1>Main Active Desktop Page</h1>
    <div class="row">
      <button onclick="playAll()">‚ñ∂ Play All</button>
      <button onclick="pauseAll()">‚è∏ Pause All</button>
      <button onclick="nextAll()">‚è≠ Next All</button>
      <button onclick="shuffleAll()">üé≤ Shuffle All</button>
      <button onclick="restartAll()">üîÅ Restart All</button>
      <button onclick="stopAll()">‚èπ Stop All</button>
      <button onclick="toggleMuteAll()">üîá Mute/Unmute All</button>
      <button onclick="randomizeVolumeAll()">üîä Volume Randomize All</button>
      <button onclick="normalizeVolumeAll()">üéö Volume Normalize All</button>
      <button onclick="toggleTheme()">üåì Dark/Light Mode</button>
    </div>
  </div>

  <div class="grid">
    <div id="player1"></div><div id="player2"></div><div id="player3"></div><div id="player4"></div>
    <div id="player5"></div><div id="player6"></div><div id="player7"></div><div id="player8"></div>
  </div>

  <div class="activity" id="activityPanel"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let players = [];
    let videoList = [];
    let isMutedAll = true;

    const NORMALIZE_VOLUME_TARGET = 20;

    // --- Logging helper ---
    function log(msg) {
      console.log(msg);
      const panel = document.getElementById("activityPanel");
      const div = document.createElement("div");
      div.className = "log-entry";
      div.textContent = msg;
      panel.appendChild(div);
      panel.scrollTop = panel.scrollHeight;
    }
    const ts = () => new Date().toLocaleTimeString();

    // --- Load video list ---
    fetch("https://raw.githubusercontent.com/DeadManWalkingTO/MacrosDmW/refs/heads/main/player/list.txt")
      .then(r => r.text())
      .then(text => {
        videoList = text.trim().split("\n").filter(Boolean);
        initPlayers(getRandomVideos(8));
      });

    function getRandomVideos(n) {
      const shuffled = [...videoList].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, n);
    }

    function initPlayers(videoIds) {
      videoIds.forEach((id, index) => {
        players[index] = new YT.Player(`player${index+1}`, {
          videoId: id,
          events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
        });
      });
    }

    function onPlayerReady(event) {
      const p = event.target;
      p.mute();
      p.playVideo();
      log(`[${ts()}] ‚ñ∂ Player ready: id=${p.getVideoData().video_id}`);
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        const newId = getRandomVideos(1)[0];
        event.target.loadVideoById(newId);
        log(`[${ts()}] ‚è≠ Auto‚Äënext: id=${newId}`);
      }
    }

    // --- Controls ---
    function playAll() { players.forEach(p => p.playVideo()); log(`[${ts()}] ‚ñ∂ Play All`); }
    function pauseAll() { players.forEach(p => p.pauseVideo()); log(`[${ts()}] ‚è∏ Pause All`); }
    function stopAll() { players.forEach(p => p.stopVideo()); log(`[${ts()}] ‚èπ Stop All`); }
    function nextAll() {
      players.forEach(p => { let newId = getRandomVideos(1)[0]; p.loadVideoById(newId); p.playVideo(); log(`[${ts()}] ‚è≠ Next: id=${newId}`); });
    }
    function shuffleAll() {
      let shuffled = getRandomVideos(players.length);
      players.forEach((p,i) => { p.loadVideoById(shuffled[i]); p.playVideo(); log(`[${ts()}] üé≤ Shuffle: p${i+1} -> ${shuffled[i]}`); });
    }
    function restartAll() {
      let newSet = getRandomVideos(players.length);
      players.forEach((p,i) => { p.stopVideo(); p.loadVideoById(newSet[i]); p.playVideo(); log(`[${ts()}] üîÅ Restart: p${i+1} -> ${newSet[i]}`); });
    }
    function toggleMuteAll() {
      if (isMutedAll) { players.forEach(p => p.unMute()); log(`[${ts()}] üîä Unmute All`); }
      else { players.forEach(p => p.mute()); log(`[${ts()}] üîá Mute All`); }
      isMutedAll = !isMutedAll;
    }
    function randomizeVolumeAll() {
      players.forEach((p,i) => { let v = Math.floor(Math.random()*101); p.setVolume(v); log(`[${ts()}] üîä Random volume: p${i+1} -> ${v}%`); });
    }
    function normalizeVolumeAll() {
      players.forEach((p,i) => { p.setVolume(NORMALIZE_VOLUME_TARGET); log(`[${ts()}] üéö Normalize volume: p${i+1} -> ${NORMALIZE_VOLUME_TARGET}%`); });
    }
    function toggleTheme() {
      document.body.classList.toggle("light");
      log(`[${ts()}] üåì Theme toggled: ${document.body.classList.contains("light") ? "Light" : "Dark"}`);
    }
  </script>
</body>
</html>
