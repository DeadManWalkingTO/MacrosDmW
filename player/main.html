<!DOCTYPE html>
<html>
<head>
  <title>Main Active Desktop Page</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#111; color:#eee; }
    .controls { background:#1a1a1a; padding:12px; text-align:center; position:sticky; top:0; z-index:10; }
    .controls h1 { margin:0 0 8px; }
    .controls .row { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
    button { background:#222; color:#eee; border:1px solid #444; padding:8px 14px; border-radius:6px; cursor:pointer; }
    button:hover { background:#2b2b2b; }
    .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; padding:10px; height:60vh; }
    iframe { width:100%; height:100%; border:none; border-radius:8px; background:#000; }
    @media(max-width:768px){ .grid{grid-template-columns:repeat(2,1fr);height:auto;} iframe{height:220px;} }
    .activity { background:#1a1a1a; border-top:1px solid #333; padding:10px; font-size:13px; height:20vh; overflow-y:auto; }
    .stats { background:#222; padding:8px; font-size:12px; margin-top:6px; border-radius:6px; }
    body.light { background:#f9f9f9; color:#222; }
    body.light .controls { background:#eaeaea; }
    body.light button { background:#fff; color:#222; border-color:#ccc; }
    body.light button:hover { background:#ddd; }
    body.light .activity { background:#eaeaea; }
    body.light .stats { background:#ddd; }
  </style>
</head>
<body>
  <div class="controls">
    <h1>Main Active Desktop Page</h1>
    <div class="row">
      <button onclick="playAll()">â–¶ Play All</button>
      <button onclick="pauseAll()">â¸ Pause All</button>
      <button onclick="nextAll()">â­ Next All</button>
      <button onclick="shuffleAll()">ğŸ² Shuffle All</button>
      <button onclick="restartAll()">ğŸ” Restart All</button>
      <button onclick="stopAll()">â¹ Stop All</button>
      <button onclick="toggleMuteAll()">ğŸ”‡ Mute/Unmute All</button>
      <button onclick="randomizeVolumeAll()">ğŸ”Š Volume Randomize All</button>
      <button onclick="normalizeVolumeAll()">ğŸš Volume Normalize All</button>
      <button onclick="toggleTheme()">ğŸŒ“ Dark/Light Mode</button>
    </div>
  </div>

  <div class="grid">
    <div id="player1"></div><div id="player2"></div><div id="player3"></div><div id="player4"></div>
    <div id="player5"></div><div id="player6"></div><div id="player7"></div><div id="player8"></div>
  </div>

  <div class="activity" id="activityPanel"></div>
  <div class="stats" id="statsPanel"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // --- State
    let players = [], videoList = [], isMutedAll = true;
    const stats = { autoNext:0, manualNext:0, shuffle:0, restart:0, pauses:0, volumeChanges:0 };

    // --- Config
    const START_DELAY_MIN_S = 5;      // ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚
    const START_DELAY_MAX_S = 180;    // Î¼Î­Î³Î¹ÏƒÏ„Î· ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚
    const INIT_SEEK_MAX_S   = 60;     // Ï„Ï…Ï‡Î±Î¯Î± Î±ÏÏ‡Î¹ÎºÎ® Î¼ÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ·
    const UNMUTE_VOL_MIN    = 10;     // Ï„Ï…Ï‡Î±Î¯Î± Î­Î½Ï„Î±ÏƒÎ· ÏƒÏ„Î¿ unmute (min)
    const UNMUTE_VOL_MAX    = 30;     // Ï„Ï…Ï‡Î±Î¯Î± Î­Î½Ï„Î±ÏƒÎ· ÏƒÏ„Î¿ unmute (max)
    const NORMALIZE_VOLUME_TARGET = 20;

    // --- Helpers
    const ts = () => new Date().toLocaleTimeString();
    function log(msg){
      console.log(msg);
      const panel = document.getElementById("activityPanel");
      const div = document.createElement("div");
      div.textContent = msg;
      panel.appendChild(div);
      panel.scrollTop = panel.scrollHeight;
      updateStats();
    }
    function updateStats(){
      document.getElementById("statsPanel").innerHTML =
        `ğŸ“Š Stats â€” AutoNext:${stats.autoNext} | ManualNext:${stats.manualNext} | Shuffle:${stats.shuffle} | Restart:${stats.restart} | Pauses:${stats.pauses} | VolumeChanges:${stats.volumeChanges}`;
    }
    function rndInt(min, max){ return Math.floor(min + Math.random() * (max - min + 1)); }
    function rndDelayMs(minS, maxS){ return (minS + Math.random() * (maxS - minS)) * 1000; }

    // --- Load video list
    fetch("https://raw.githubusercontent.com/DeadManWalkingTO/MacrosDmW/refs/heads/main/player/list.txt")
      .then(r => r.text())
      .then(text => { videoList = text.trim().split("\n").filter(Boolean); initPlayers(getRandomVideos(8)); });

    function getRandomVideos(n){ return [...videoList].sort(() => Math.random() - 0.5).slice(0, n); }

    function initPlayers(videoIds){
      videoIds.forEach((id, i) => {
        players[i] = new YT.Player(`player${i+1}`, {
          videoId: id,
          events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
        });
      });
    }

    // --- Player events
    function onPlayerReady(event){
      const p = event.target;
      p.mute();

      // Î¤Ï…Ï‡Î±Î¯Î± ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ player
      const startDelayMs = rndDelayMs(START_DELAY_MIN_S, START_DELAY_MAX_S);
      setTimeout(() => {
        const seek = rndInt(0, INIT_SEEK_MAX_S);
        p.seekTo(seek, true);
        p.playVideo();
        p.setPlaybackQuality('small');
        log(`[${ts()}] â–¶ Start after delay: id=${p.getVideoData().video_id}, delay=${Math.round(startDelayMs/1000)}s, seek=${seek}s`);
      }, startDelayMs);
    }

    function onPlayerStateChange(event){
      if (event.data === YT.PlayerState.ENDED) {
        const newId = getRandomVideos(1)[0];
        event.target.loadVideoById(newId);
        stats.autoNext++;
        log(`[${ts()}] â­ AutoNext: ${newId}`);
      }
    }

    // --- Controls
    function playAll(){ players.forEach(p => p.playVideo()); log(`[${ts()}] â–¶ Play All`); }
    function pauseAll(){ players.forEach(p => p.pauseVideo()); stats.pauses++; log(`[${ts()}] â¸ Pause All`); }
    function stopAll(){ players.forEach(p => p.stopVideo()); log(`[${ts()}] â¹ Stop All`); }

    function nextAll(){
      players.forEach(p => { const newId = getRandomVideos(1)[0]; p.loadVideoById(newId); p.playVideo(); });
      stats.manualNext++; log(`[${ts()}] â­ Next All`);
    }

    function shuffleAll(){
      const sh = getRandomVideos(players.length);
      players.forEach((p,i) => { p.loadVideoById(sh[i]); p.playVideo(); });
      stats.shuffle++; log(`[${ts()}] ğŸ² Shuffle All`);
    }

    function restartAll(){
      const set = getRandomVideos(players.length);
      players.forEach((p,i) => { p.stopVideo(); p.loadVideoById(set[i]); p.playVideo(); });
      stats.restart++; log(`[${ts()}] ğŸ” Restart All`);
    }

    // Mute/Unmute Ï€Î¿Ï… Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Enable Sound Î¼Îµ Ï„Ï…Ï‡Î±Î¯Î± Î­Î½Ï„Î±ÏƒÎ·
    function toggleMuteAll(){
      if (isMutedAll) {
        players.forEach((p,i) => {
          p.unMute();
          const v = rndInt(UNMUTE_VOL_MIN, UNMUTE_VOL_MAX); // 10â€“30%
          p.setVolume(v);
          log(`[${ts()}] ğŸ”Š Enable Sound + Unmute: Player${i+1} -> ${v}%`);
        });
      } else {
        players.forEach((p,i) => { p.mute(); log(`[${ts()}] ğŸ”‡ Mute: Player${i+1}`); });
      }
      isMutedAll = !isMutedAll;
    }

    function randomizeVolumeAll(){
      players.forEach((p,i) => { const v = rndInt(0, 100); p.setVolume(v); });
      stats.volumeChanges++; log(`[${ts()}] ğŸ”Š Randomize Volume All`);
    }

    function normalizeVolumeAll(){
      players.forEach((p,i) => { p.setVolume(NORMALIZE_VOLUME_TARGET); });
      stats.volumeChanges++; log(`[${ts()}] ğŸš Normalize Volume All`);
    }

    function toggleTheme(){ document.body.classList.toggle("light"); log(`[${ts()}] ğŸŒ“ Theme toggled`); }
  </script>
</body>
</html>
